<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="../style.css">
</head>

<body>
<header>
<p>
Prev: <a href="run">Run</a>,
Next: <a href="layers">Layers</a>,
Up: <a href=".">Learn</a>
</p>
</header>
<hr>
<main>
<h1>Combine</h1>

<p>
<a href="run">So far</a> we have used Goat to print some text on the screen,
which was fun.
Text is an example of a 'plain' data form that Goat has builtin rules for working with.
Numbers are another plain data form of Goat that we will see in future tutorials.
</p>

<p>
Like most programming languages,
Goat also comes with <em>combining forms</em> which can glue together the simpler forms.
These combining forms can be used to organise our code,
keeping together related data and separating unrelated data.
</p>

<p>
As we will see, 
combining forms generally need to be matched with corresponding <em>selection forms</em> for getting at the parts.
</p>

<p>
Goat has a very general combining form called a <em>block</em>,
and a corresponding <em>lookup</em> form for selection.
Blocks are perhaps best understood via demonstration.
Let's start with the Goat Pen below.
</p>

<textarea class="codebox"></textarea>
<pre class="codebox-output" hidden></pre>

<p>
The example below uses a block to group together some facts that relate to a common farm animal,
and selects a fact to be displayed.
</p>

<pre class="codebox">
facts = {
  .speciesName = "Capra hircus";
  .diet = "herbivore";
  .skills = "climbing, chariot-pulling";
  };
.inspect = facts.diet;
</pre>

<p>
Type out the code above into the Goat Pen
(copying it will also work).
Upon navigating away from the box you should see the following printed below the box:
</p>

<pre class="codebox-output">
Something went wrong...
</pre>

<p>
You have now made a second running Goat program.
Go you!
</p>

<h2>Combine and select</h4>

<p>
The program above demonstrates the use of combination and selection in Goat.
In the definition of <code>facts</code> we see Goat's block declaration syntax,
starting on line 1 with an open brace <code>{</code>,
and continuing until the closing brace <code>}</code> on line 5.
Perhaps familiarly,
the block contains a series of words and definitions,
separated by <code>=</code> and ended by <code>;</code>.
The block reflects the combination of the plain text values used as definitions.
</p>

<p>
The block defines three words,
ach using a <code>.</code> prefix:
<code>speciesName</code>,
<code>diet</code> and <code>skills</code>.
Let us look briefly at the last line for the significance of these names.
</p>

<p>
The last line defines <code>inspect</code>,
which we recall from <a href="run">the earlier tutorial</a> defines the output box value of the Goat Pen.
The definition references <code>goatFacts</code> and uses <em>lookup</em> syntax in the form <code>.</code><em>word</em>.
</p>

<p>
In effect,
we are defining <code>inspect</code> to correspond to the definition of <code>diet</code> inside the combination refered to by <code>facts</code>.
Tracing back to the definition of <code>facts</code>,
we see that it is indeed the same as that displayed by the output box:
"herbivore".
</p>

<h2>New syntax</h2>

<h2>Discover</h2>



<h4>Creating compound objects</h4> 

<p>
The right hand side of the <code>myPoint</code> assignment is a <em>compound object</em>,
declared using "block" syntax.
This object defines "components" <code>.x</code> and <code>.y</code> representing the point's x- and y- co-ordinates.
The following diagram of the first line highlights the block syntax for "declaring" a compound object.
</p>
<pre class="diagram">
1 | myPoint = <span class="li1">{</span> <span class="li2">.x = 2</span><span class="li3">;</span> <span class="li2">.y = 4</span> <span class="li1">}</span>;
              <span class="li1">^</span> <!--           --><!---->      <span class="li3">^</span> <!--           --><!---->       <span class="li1">^</span>
              <span class="li1">1</span> <span class="li2">^^^^^^</span><span class="li3">3</span> <span class="li2">^^^^^^</span> <span class="li1">1</span>
              <!--           --><!---->  <span class="li2">2</span>     <!--          --><!---->  <span class="li2">2</span>
</pre>
<ol class="diagram">
<li>
Block declarations start with an <strong>open brace</strong> <code>{</code> and end with a <strong>close brace</strong> <code>}</code>.
As usual, spaces immediately before and after are ignored.
</li>
<li>
The declaration involves a sequence of assignments in the manner we have been writing our programs so far.
We have prefixed the defined names with <code>.</code> to designate that they represent "components",
allowing access from code outside the block as discussed in the next section.
</li>
<li>
As usual, assignments are terminated by a <code>;</code>,
and terminating the last definition of a block is optional.
</li>
</ol>

<h4>Using compound objects</h4>

<p>
In definition of <code>inspect</code> on the second line of our program,
we see how to access a component of a compound object â€“
<code>myPoint</code> (representing the declared object) is followed by the same <code>.y</code> syntax used in the definition.
We have seen this evaluates to the number given in the corresponding definition, 4.
In Goat, names defined within a block as components (using the <code>.</code> prefix) are able to be accessed in this manner.
</p>


<h4>Missing names</h4>

<p>
It is an error to access a name that is not defined as a component.
To see this let's modify our program above so that we instead access a component <code>.z</code> on <code>myPoint</code>.
Make the following change to the second line of our program in the Goat pen above.
</p>
<pre class="codebox">
.inspect = myPoint.z;
</pre>
<p>
After running, you should see the following printed below the box.
</p>
<pre class="codebox-output">
&lt;error: Missing component: z&gt;
</pre>
</main>
<hr>
<footer>
<p>
Prev: <a href="maths">Maths</a>,
Next: <a href="layers">Layers</a>,
Up: <a href=".">Learn</a>
</p>
</footer>

<script src="../script/setup-goat-web.js"></script>
<script src="../script/goat-web.js"></script>
</body>
</html>
