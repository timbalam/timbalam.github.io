<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="../style.css">
</head>

<body>
<header>
<p>
Prev: <a href="updates">Updates</a>,
Up: <a href=".">Learn</a>
</p>
</header>
<hr>
<main>
<h1>Referencing the future</h1>

<p>
Now that we have seen how to update block definitions,
for our final tutorial,
we will look into a complementary capability,
making references to the future!
We will need our trusty Goat Pen:
</p>

<textarea class="codebox"></textarea>

<p>
The code for this demonstration is below.
</p>
<pre class="codebox">
myPlane = { .z = .x - .y + 7 };
myPointDepth = myPlane{ .x = 1; .y = 2 }.z;
.inspect = myPointDepth;
</pre>

<p>
Okay, let's see what this does!
Type it into the Goat Pen and run it.
The depth of the point should be:
</p>
<pre class="codebox-output">
6.0
</pre>

<h4>How it looks and what it means</h4>

<p>
For a final time,
let's consider the annotated program below and discuss some interesting parts.
</p>
<pre class="diagram">
1 | myPlane = { .z = <span class="li1">.x - .y + 7</span> };
                     <span class="li1">^^^^^^^^^^^</span>
                     <span class="li1">1</span>
2 | myPointDepth = <span class="li2">myPlane{ .x = 1; .y = 2 }</span><span class="li3">.z</span>;
                   <span class="li2">^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="li3"></span>
                   <span class="li2">2</span>                        <span class="li3">^^</span>
                   <span class="li2"></span>                         <span class="li3">3</span>
3 | .inspect = myPointDepth;
</pre>
<ol class="diagram">
<li>
Probably the most notable part of the program is the definition of the component <code>.z</code>
inside the block defining <code>myPlane</code>.
<code>.z</code> is defined as a mathematical expression where two of the inputs are <code>.</code> prefixed names <code>.x</code> and <code>.y</code>,
for which there are no corresponding definitions!
How can this be?
The next line contains the answers.
</li>
<li>
The definition made to <code>myPointDepth</code> shows how we can use <code>myPlane</code> in a sensible way.
We just need to update it with the missing definitions!
</li>
<li>
We don't have to name the updated value we have created,
instead we can immediately access <code>.z</code> and assign that as the definition for <code>myPointDepth</code>.
Running the program shows that this evaluates to 7.0,
illustrating the program behaviour â€”
the provided <code>.x</code> and <code>.y</code> values are substituted into the definition for <code>.z</code>.
</li>
</ol>

<h4>Live names</h4>

<p>
The vital component making this exercise work is the use of <code>.</code> prefixed names
(i.e. <code>.x</code> and <code>.y</code>)
in the definition of <code>.z</code> (in the block defining <code>myPlane</code>).
Without the prefix, we would get missing definition errors (try it!),
since we haven't defined the names.
When we use the <code>.</code> prefix we get a "live" reference to the corresponding component of the block,
that updates whenever the corresponding component updates.
The Goat interpreter will wait until the <code>.z</code> is accessed,
and then access <code>.x</code> and <code>.y</code>, substituting them into the <code>.z</code> definition.
</p>

<p>
Values like <code>myPlane</code> that are only partially defined act as templates from which complete values can be made by updating.
After updating <code>myPlane</code> with <code>.x</code> and <code>.y</code> component definitions,
we can safely access <code>.z</code> in the definition of <code>myPointDepth</code>. 
Goat will help us by checking that we only try to access completed components.
I.e. we get an error if we try to access <code>myPlane.z</code> directly (try it too!).
</p>

<h4>The journey continues...</h4>

<p>
We have now completed a basic tour of how Goat reads and is written.
For those of you whose curiosity has been piqued,
now might be time to try some <a href="../examples">Examples</a>.
</p>
</main>
<hr>
<footer>
<p>
Prev: <a href="updates">Updates</a>,
Up: <a href=".">Learn</a>
</p>
</footer>

<script src="../script/setup-goat-web.js"></script>
<script src="../script/goat-web.js"></script>
</body>
</html>
